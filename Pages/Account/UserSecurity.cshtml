@page
@model UserSecurityModel

<h3 class="mb-4">User Security</h3>

@if (TempData["Message"] != null)
{
    <div class="alert alert-success">
        @TempData["Message"]
    </div>
}

<!-- Select User -->
<div class="card shadow p-4 mb-4 col-md-6">
    <h5>Select User</h5>
    <form method="get">
        <div class="mb-3">
            <label class="form-label">User</label>
            <select class="form-select" name="id" required>
                <option value="">-- Select User --</option>
                @foreach (var u in Model.AllUsers)
                {
                    <option value="@u.Id">
                        @u.Username (@u.Role)
                    </option>
                }
            </select>
        </div>
        <button class="btn btn-primary">
            <i class="bi bi-search"></i> Load User
        </button>
    </form>
</div>

@if (Model.SelectedUser != null)
{
    <div class="card shadow p-4 w-100">

        <table class="table table-bordered">
            <tr>
                <th style="width:200px;">User ID</th>
                <td>@Model.SelectedUser.Id</td>
            </tr>
            <tr>
                <th>Username</th>
                <td>@Model.SelectedUser.Username</td>
            </tr>
            <tr>
                <th>Role</th>
                <td>@Model.SelectedUser.Role</td>
            </tr>
            <tr>
                <th>Status</th>
                <td>
                    @if (Model.SelectedUser.IsLocked)
                    {
                        <span class="badge bg-danger">Locked</span>
                    }
                    else
                    {
                        <span class="badge bg-success">Active</span>
                    }
                </td>
            </tr>
        </table>

        <hr />

        <!-- Lock / Unlock -->
        <form method="post" asp-page-handler="ToggleLock" class="mb-4">
            @Html.AntiForgeryToken()
            <input type="hidden" asp-for="Id" />
            <button class="btn @(Model.SelectedUser.IsLocked ? "btn-success" : "btn-warning")">
                <i class="bi @(Model.SelectedUser.IsLocked ? "bi-unlock" : "bi-lock")"></i>
                @(Model.SelectedUser.IsLocked ? "Unlock User" : "Lock User")
            </button>
        </form>

        <hr />

        <!-- Change Password -->
        <form method="post" asp-page-handler="ChangePassword" class="col-md-6">
            @Html.AntiForgeryToken()
            <input type="hidden" asp-for="Id" />

            <div class="mb-3">
                <label class="form-label">New Password</label>
                <input asp-for="NewPassword"
                       type="password"
                       class="form-control"
                       placeholder="Enter new password" />
            </div>

            <button class="btn btn-primary">
                <i class="bi bi-key"></i> Change Password
            </button>
        </form>

    </div>
}
